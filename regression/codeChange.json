{
    "name": "Name of this test run",
    "scenarios": [ ["Code Caller", "@numCodeCallers"], ["Code Changer", 1] ],
    "sequencing": "Parallel",

    "globals": {
        "numCodeCallers": 20,
        "callIterations": 100,
        "Horrible1Output": "This is horrible 1",
        "Horrible2Output": "This is really horrible 2",
        "Horrible3Output": "This is really, really horrible 3"
    },

    "locals": {
    },


    "Code Caller": {
        "name": "Call and Assert",
        "steps": [
            ["setUser", "foo@bar.com"],

            ["repeat", "@callIterations", [

                ["sync", "Wait for changed service", ["+", "@numCodeCallers", 1]],
                ["call", "HorribleService", {} ],
                ["assert", ["==", "@returnValue", "@Horrible1Output"]],
                ["sync", "Wait for calls to complete", ["+", "@numCodeCallers", 1]],

                ["sync", "Wait for changed service", ["+", "@numCodeCallers", 1]],
                ["call", "HorribleService", {} ],
                ["assert", ["==", "@returnValue", "@Horrible2Output"]],
                ["sync", "Wait for calls to complete", ["+", "@numCodeCallers", 1]],

                ["sync", "Wait for changed service", ["+", "@numCodeCallers", 1]],
                ["call", "HorribleService", {} ],
                ["assert", ["==", "@returnValue", "@Horrible3Output"]],
                ["sync", "Wait for calls to complete", ["+", "@numCodeCallers", 1]] ]
            ]
        ]
    },


    "Code Changer": {
        "name": "Modify Code Service",
        "steps": [
            ["setUser", "bar@bar.com"],

            ["repeat", "@callIterations", [
                ["updateService", "HorribleService", "@HorribleService1.js", ["paramXXX"]],
                ["sync", "Wait for changed service", ["+", "@numCodeCallers", 1]],
                ["sync", "Wait for calls to complete", ["+", "@numCodeCallers", 1]],

                ["updateService", "HorribleService", "@HorribleService2.js", ["paramXXX"]],
                ["sync", "Wait for changed service", ["+", "@numCodeCallers", 1]],
                ["sync", "Wait for calls to complete", ["+", "@numCodeCallers", 1]],

                ["updateService", "HorribleService", "@HorribleService3.js", ["paramXXX"]],
                ["sync", "Wait for changed service", ["+", "@numCodeCallers", 1]],
                ["sync", "Wait for calls to complete", ["+", "@numCodeCallers", 1]]]
            ]
        ]
    }
}
